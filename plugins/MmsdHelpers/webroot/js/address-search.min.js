var MMSD=MMSD||{};MMSD.addressSearchVars={}; 
$(document).ready(function(){MMSD.helperAddressSearch.setDefaultValues();$(".address-search-ify").on("focus",function(){MMSD.helperAddressSearch.addressSearchIfy($(this))});MMSD.addressSearchVars.modalTarget.on("shown.bs.modal",function(){$("#address-search-number").trigger("focus")});MMSD.addressSearchVars.modalTarget.on("hidden.bs.modal",function(){MMSD.helperAddressSearch.clearAddressSearch()});$("#address-search-button").on("click",function(){MMSD.helperAddressSearch.executeAddressSearch()});$(".address-search-use-anyway").on("click",
function(){MMSD.helperAddressSearch.useUnfoundAddress()});$("#address-search-cancel").on("click",function(){MMSD.helperAddressSearch.addressSearchCancel()})});
MMSD.helperAddressSearch={addressSearchIfy:function(a){MMSD.helperAddressSearch.setDefaultValues();MMSD.helperAddressSearch.hideDivs();MMSD.addressSearchVars.modalObject.show();void 0!=a.data("address_search_field_display")&&(MMSD.addressSearchVars.fieldDisplay=a.data("address_search_field_display"));void 0!=a.data("address_search_field_id")&&(MMSD.addressSearchVars.fieldID=a.data("address_search_field_id"));void 0!=a.data("address_search_in_district")&&(MMSD.addressSearchVars.inDistrict=a.data("address_search_in_district"));
void 0!=a.data("address_search_fields_prefix")&&(MMSD.addressSearchVars.fieldsPrefix=a.data("address_search_fields_prefix"))},executeAddressSearch:function(){$("#address-search-button").blur();let a={number:MMSD.addressSearchVars.number.val(),prefix:MMSD.addressSearchVars.prefix.val(),street:MMSD.addressSearchVars.street.val(),tag:MMSD.addressSearchVars.tag.val(),apt:MMSD.addressSearchVars.apt.val(),city:MMSD.addressSearchVars.city.val(),state:MMSD.addressSearchVars.state.val(),zip:MMSD.addressSearchVars.zip.val()};
MMSD.addressSearchVars.resultDiv.children().detach();MMSD.addressSearchVars.resultDiv.append($("<div>").addClass("text-center").append($("<img>").attr({src:"/_resources/img/spinners/small-blue.gif"})));MMSD.addressSearchVars.resultDiv.show();MMSD.helperAddressSearch.hideDivs(!0);MMSD.addressSearchVars.modalObject.handleUpdate();$.when(MMSD.addresses.cleanAddressSearch(a)).done(function(b,c){if(b){MMSD.addressSearchVars.resultDiv.children().detach();let e=$("<ul>");$.each(c.addresses,function(f,g){f=
"fa-check-circle text-success";let h="In MMSD";"200"!=g.districtID&&(f="fa-exclamation-triangle text-danger",h="Out of MMSD");$("<li>").append($("<span>").attr({"class":"mock-link font-weight-bold"}).text(g.fullAddress+" ").on("click",function(){MMSD.helperAddressSearch.useFoundAddress(g)?MMSD.addressSearchVars.modalObject.hide():alert("Address must be in the MMSD")})).append($("<span>",{"class":"fas "+f,"aria-hidden":"true",title:h})).append($("<span>",{"class":"sr-only",text:h})).append("<br>").append(MMSD.helperAddressSearch.schoolNamesFromAddress(g)).appendTo(e)});
MMSD.addressSearchVars.resultDiv.append(e);MMSD.addressSearchVars.resultDiv.show();MMSD.addressSearchVars.notFoundDiv.show();MMSD.addressSearchVars.invalidDiv.hide();MMSD.addressSearchVars.modalObject.handleUpdate()}else MMSD.helperAddressSearch.hideDivs(),void 0==c?MMSD.addressSearchVars.failureDiv.show():MMSD.addressSearchVars.invalidDiv.show()}).fail(function(b,c){MMSD.main.errorAlert(b,c);MMSD.helperAddressSearch.hideDivs();MMSD.addressSearchVars.modalObject.handleUpdate()})},clearAddressSearch:function(){MMSD.addressSearchVars.number.val("");
MMSD.addressSearchVars.prefix.val("");MMSD.addressSearchVars.street.val("");MMSD.addressSearchVars.tag.val("");MMSD.addressSearchVars.apt.val("");MMSD.addressSearchVars.city.val("Madison");MMSD.addressSearchVars.state.val("WI");MMSD.addressSearchVars.zip.val("");MMSD.addressSearchVars.resultDiv.hide();MMSD.addressSearchVars.failureDiv.hide();MMSD.addressSearchVars.notFoundDiv.hide();MMSD.addressSearchVars.invalidDiv.hide()},schoolNamesFromAddress:function(a){let b=[],c=a.kfour?a.kfour.k4SchoolName:
"";$.each(a.elementary_boundaries,function(e,f){b.push(f.school.name)});$.each(a.middle_boundaries,function(e,f){b.push(f.school.name)});$.each(a.high_boundaries,function(e,f){b.push(f.school.name)});if(0<b.length){a=b.join(", ");let e="es"==MMSD.properties.getDocumentLanguage()?"Escuelas":"Schools";e+=": "+a;0<c.length&&(e+="; K4: "+c);return $("<span>").text(e)}return null},useFoundAddress:function(a){if(MMSD.addressSearchVars.inDistrict&&"200"!=a.districtID)return!1;$(MMSD.addressSearchVars.fieldDisplay).val(a.fullAddress);
$(MMSD.addressSearchVars.fieldID).val(a.id);a.kfour&&(a.kfour.k4SchoolCode&&$("#"+MMSD.addressSearchVars.fieldsPrefix+"k4-school-codes").val(JSON.stringify([a.kfour.k4SchoolCode])),a.kfour.k4SchoolName&&$("#"+MMSD.addressSearchVars.fieldsPrefix+"k4-school-names").val(JSON.stringify([a.kfour.k4SchoolName])),a.kfour.k4SchoolID&&$("#"+MMSD.addressSearchVars.fieldsPrefix+"k4-school-ids").val(JSON.stringify([a.kfour.k4SchoolID])));var b=[],c=[],e=[],f=[],g=[],h=[];$.each(a.elementary_boundaries,function(k,
d){f.push(d.school.SchoolCode);g.push(d.school.name);h.push(d.school.schoolID);b.push(d.school.SchoolCode);c.push(d.school.name);e.push(d.school.schoolID)});$("#"+MMSD.addressSearchVars.fieldsPrefix+"es-school-codes").val(JSON.stringify(f));$("#"+MMSD.addressSearchVars.fieldsPrefix+"es-school-names").val(JSON.stringify(g));$("#"+MMSD.addressSearchVars.fieldsPrefix+"es-school-ids").val(JSON.stringify(h));var l=[],m=[],n=[];$.each(a.middle_boundaries,function(k,d){l.push(d.school.SchoolCode);m.push(d.school.name);
n.push(d.school.schoolID);b.push(d.school.SchoolCode);c.push(d.school.name);e.push(d.school.schoolID)});$("#"+MMSD.addressSearchVars.fieldsPrefix+"ms-school-codes").val(JSON.stringify(l));$("#"+MMSD.addressSearchVars.fieldsPrefix+"ms-school-names").val(JSON.stringify(m));$("#"+MMSD.addressSearchVars.fieldsPrefix+"ms-school-ids").val(JSON.stringify(n));var p=[],q=[],r=[];$.each(a.high_boundaries,function(k,d){p.push(d.school.SchoolCode);q.push(d.school.name);r.push(d.school.schoolID);b.push(d.school.SchoolCode);
c.push(d.school.name);e.push(d.school.schoolID)});$("#"+MMSD.addressSearchVars.fieldsPrefix+"hs-school-codes").val(JSON.stringify(p));$("#"+MMSD.addressSearchVars.fieldsPrefix+"hs-school-names").val(JSON.stringify(q));$("#"+MMSD.addressSearchVars.fieldsPrefix+"hs-school-ids").val(JSON.stringify(r));$("#"+MMSD.addressSearchVars.fieldsPrefix+"all-school-codes").val(JSON.stringify(b));$("#"+MMSD.addressSearchVars.fieldsPrefix+"all-school-names").val(JSON.stringify(c));$("#"+MMSD.addressSearchVars.fieldsPrefix+
"all-school-ids").val(JSON.stringify(e));$("#"+MMSD.addressSearchVars.fieldsPrefix+"line1").val(a.line1);$("#"+MMSD.addressSearchVars.fieldsPrefix+"line2").val(a.line2);$("#"+MMSD.addressSearchVars.fieldsPrefix+"fullAddress").val(a.fullAddress);$("#residency-info").show();$(MMSD.addressSearchVars.fieldDisplay).trigger("address:ic");return!0},useUnfoundAddress:function(){let a={number:MMSD.addressSearchVars.number.val(),prefix:MMSD.addressSearchVars.prefix.val(),street:MMSD.addressSearchVars.street.val(),
tag:MMSD.addressSearchVars.tag.val(),apt:MMSD.addressSearchVars.apt.val(),city:MMSD.addressSearchVars.city.val(),state:MMSD.addressSearchVars.state.val(),zip:MMSD.addressSearchVars.zip.val()};$(MMSD.addressSearchVars.fieldID).val("");MMSD.addresses.uspsAddressSearch(a).done(function(b,c){b?($.each(["k4","es","ms","hs","all"],function(e,f){$.each(["codes","names","ids"],function(g,h){$("#"+MMSD.addressSearchVars.fieldsPrefix+f+"-school-"+h).val("")})}),$("#"+MMSD.addressSearchVars.fieldsPrefix+"line1").val(c.line1),
$("#"+MMSD.addressSearchVars.fieldsPrefix+"line2").val(c.line2),b=c.line1+" "+c.line2,$("#"+MMSD.addressSearchVars.fieldsPrefix+"fullAddress").val(b),$(MMSD.addressSearchVars.fieldDisplay).val(b),$("#residency-info").show(),MMSD.addressSearchVars.modalObject.hide(),$(MMSD.addressSearchVars.fieldDisplay).trigger("address:usps")):(MMSD.addressSearchVars.failureDiv.hide(),MMSD.addressSearchVars.invalidDiv.show())}).fail(function(b,c){MMSD.main.errorAlert(b,c)});return!0},addressSearchCancel:function(){$.each(["k4",
"es","ms","hs","all"],function(a,b){$.each(["codes","names","ids"],function(c,e){$("#"+MMSD.addressSearchVars.fieldsPrefix+b+"-school-"+e).val("")})});$("#"+MMSD.addressSearchVars.fieldsPrefix+"line1").val("");$("#"+MMSD.addressSearchVars.fieldsPrefix+"line2").val("");$("#"+MMSD.addressSearchVars.fieldsPrefix+"fullAddress").val("");$(MMSD.addressSearchVars.fieldID).val("");$(MMSD.addressSearchVars.fieldDisplay).val("");MMSD.addressSearchVars.modalObject.hide();$(MMSD.addressSearchVars.fieldDisplay).trigger("address:cancel")},
setDefaultValues:function(){MMSD.addressSearchVars={modalTarget:$("#modal-address-search"),fieldDisplay:"#address-textfield",fieldID:"#addressID",inDistrict:!1,fieldsPrefix:"address-",resultDiv:$("#address-search-results-div"),failureDiv:$("#address-search-failure-div"),notFoundDiv:$("#address-search-notfound-div"),invalidDiv:$("#address-search-invalid-div"),number:$("#address-search-number"),prefix:$("#address-search-prefix"),street:$("#address-search-street"),tag:$("#address-search-tag"),apt:$("#address-search-apt"),
city:$("#address-search-city"),state:$("#address-search-state"),zip:$("#address-search-zip")};MMSD.addressSearchVars.modalObject=new bootstrap.Modal(document.getElementById("modal-address-search"))},hideDivs:function(a=!1){MMSD.addressSearchVars.failureDiv.hide();MMSD.addressSearchVars.notFoundDiv.hide();MMSD.addressSearchVars.invalidDiv.hide();a||(MMSD.addressSearchVars.resultDiv.hide(),MMSD.addressSearchVars.resultDiv.children().detach())}};
