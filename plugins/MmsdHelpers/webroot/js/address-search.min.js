var MMSD=MMSD||{};MMSD.addressSearchVars={},$(document).ready(function(){MMSD.thisApp.setDefaultValues(),$(".address-search-ify").on("focus",function(){MMSD.thisApp.addressSearchIfy($(this))}),MMSD.addressSearchVars.modal.on("shown.bs.modal",function(){$("#addresssearch-number").trigger("focus")}),MMSD.addressSearchVars.modal.on("hidden.bs.modal",function(){MMSD.thisApp.clearAddressSearch()}),$("#address-search-button").on("click",function(){MMSD.thisApp.executeAddressSearch()}),$(".address-search-use-anyway").on("click",function(){MMSD.thisApp.useUnfoundAddress()})}),MMSD.thisApp={addressSearchIfy:function(a){MMSD.thisApp.setDefaultValues(),MMSD.thisApp.hideDivs(),MMSD.addressSearchVars.modal.modal(),a.data("address_search_field_display")!=null&&(MMSD.addressSearchVars.fieldDisplay=a.data("address_search_field_display")),a.data("address_search_field_id")!=null&&(MMSD.addressSearchVars.fieldID=a.data("address_search_field_id")),a.data("address_search_in_district")!=null&&(MMSD.addressSearchVars.inDistrict=a.data("address_search_in_district")),a.data("address_search_fields_prefix")!=null&&(MMSD.addressSearchVars.fieldsPrefix=a.data("address_search_fields_prefix"))},executeAddressSearch:function(){$("#address-search-button").blur();let a={number:MMSD.addressSearchVars.number.val(),prefix:MMSD.addressSearchVars.prefix.val(),street:MMSD.addressSearchVars.street.val(),tag:MMSD.addressSearchVars.tag.val(),apt:MMSD.addressSearchVars.apt.val(),city:MMSD.addressSearchVars.city.val(),state:MMSD.addressSearchVars.state.val(),zip:MMSD.addressSearchVars.zip.val()};MMSD.addressSearchVars.resultDiv.children().detach(),MMSD.addressSearchVars.resultDiv.append($("<div>").addClass("text-center").append($("<img>").attr({src:"/_resources/img/spinners/small-blue.gif"}))),MMSD.addressSearchVars.resultDiv.show(),MMSD.thisApp.hideDivs(!0),MMSD.addressSearchVars.modal.modal("handleUpdate"),$.when(MMSD.addresses.cleanAddressSearch(a)).done(function(a,b){if(a){MMSD.addressSearchVars.resultDiv.children().detach();let a=$("<ul>");$.each(b.addresses,function(b,c){let d="fa-check-circle text-success",e="In MMSD";"200"!=c.districtID&&(d="fa-exclamation-triangle text-danger",e="Out of MMSD"),$("<li>").append($("<span>").attr({class:"mock-link font-weight-bold"}).text(c.fullAddress+" ").on("click",function(){let a=MMSD.thisApp.useFoundAddress(c);a?MMSD.addressSearchVars.modal.modal("hide"):alert("Address must be in the MMSD")})).append($("<span>",{class:"fas "+d,"aria-hidden":"true",title:e})).append($("<span>",{class:"sr-only",text:e})).append("<br>").append(MMSD.thisApp.schoolNamesFromAddress(c)).appendTo(a)}),MMSD.addressSearchVars.resultDiv.append(a),MMSD.addressSearchVars.resultDiv.show(),MMSD.addressSearchVars.ignoreDiv.show(),MMSD.addressSearchVars.invalidDiv.hide(),MMSD.addressSearchVars.modal.modal("handleUpdate")}else MMSD.thisApp.hideDivs(),null==b?MMSD.addressSearchVars.failureDiv.show():MMSD.addressSearchVars.invalidDiv.show()}).fail(function(a,b){MMSD.main.errorAlert(a,b),MMSD.thisApp.hideDivs(),MMSD.addressSearchVars.modal.modal("handleUpdate")})},clearAddressSearch:function(){MMSD.addressSearchVars.number.val(""),MMSD.addressSearchVars.prefix.val(""),MMSD.addressSearchVars.street.val(""),MMSD.addressSearchVars.tag.val(""),MMSD.addressSearchVars.apt.val(""),MMSD.addressSearchVars.city.val("Madison"),MMSD.addressSearchVars.state.val("WI"),MMSD.addressSearchVars.zip.val(""),MMSD.addressSearchVars.resultDiv.hide(),MMSD.addressSearchVars.failureDiv.hide(),MMSD.addressSearchVars.ignoreDiv.hide(),MMSD.addressSearchVars.invalidDiv.hide()},schoolNamesFromAddress:function(a){let b=[],c=a.kfour?a.kfour.k4SchoolName:"";if($.each(a.elementary_boundaries,function(a,c){b.push(c.school.name)}),$.each(a.middle_boundaries,function(a,c){b.push(c.school.name)}),$.each(a.high_boundaries,function(a,c){b.push(c.school.name)}),0<b.length){let a=b.join(", "),d="es"==MMSD.properties.getDocumentLanguage()?"Escuelas":"Schools";return d+=": "+a,0<c.length&&(d+="; K4: "+c),$("<span>").text(d)}return null},useFoundAddress:function(a){if(MMSD.addressSearchVars.inDistrict&&"200"!=a.districtID)return!1;$(MMSD.addressSearchVars.fieldDisplay).val(a.fullAddress),$(MMSD.addressSearchVars.fieldID).val(a.id),a.kfour&&(a.kfour.k4SchoolCode&&$("#"+MMSD.addressSearchVars.fieldsPrefix+"k4-school-codes").val(JSON.stringify([a.kfour.k4SchoolCode])),a.kfour.k4SchoolName&&$("#"+MMSD.addressSearchVars.fieldsPrefix+"k4-school-names").val(JSON.stringify([a.kfour.k4SchoolName])),a.kfour.k4SchoolID&&$("#"+MMSD.addressSearchVars.fieldsPrefix+"k4-school-ids").val(JSON.stringify([a.kfour.k4SchoolID])));let b={codes:[],names:[],IDs:[]},c={codes:[],names:[],IDs:[]};$.each(a.elementary_boundaries,function(a,d){c.codes.push(d.school.SchoolCode),c.names.push(d.school.name),c.IDs.push(d.school.schoolID),b.codes.push(d.school.SchoolCode),b.names.push(d.school.name),b.IDs.push(d.school.schoolID)}),$("#"+MMSD.addressSearchVars.fieldsPrefix+"es-school-codes").val(JSON.stringify(c.codes)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"es-school-names").val(JSON.stringify(c.names)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"es-school-ids").val(JSON.stringify(c.IDs));let d={codes:[],names:[],IDs:[]};$.each(a.middle_boundaries,function(a,c){d.codes.push(c.school.SchoolCode),d.names.push(c.school.name),d.IDs.push(c.school.schoolID),b.codes.push(c.school.SchoolCode),b.names.push(c.school.name),b.IDs.push(c.school.schoolID)}),$("#"+MMSD.addressSearchVars.fieldsPrefix+"ms-school-codes").val(JSON.stringify(d.codes)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"ms-school-names").val(JSON.stringify(d.names)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"ms-school-ids").val(JSON.stringify(d.IDs));let e={codes:[],names:[],IDs:[]};return $.each(a.high_boundaries,function(a,c){e.codes.push(c.school.SchoolCode),e.names.push(c.school.name),e.IDs.push(c.school.schoolID),b.codes.push(c.school.SchoolCode),b.names.push(c.school.name),b.IDs.push(c.school.schoolID)}),$("#"+MMSD.addressSearchVars.fieldsPrefix+"hs-school-codes").val(JSON.stringify(e.codes)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"hs-school-names").val(JSON.stringify(e.names)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"hs-school-ids").val(JSON.stringify(e.IDs)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"all-school-codes").val(JSON.stringify(b.codes)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"all-school-names").val(JSON.stringify(b.names)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"all-school-ids").val(JSON.stringify(b.IDs)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"line1").val(""),$("#"+MMSD.addressSearchVars.fieldsPrefix+"line2").val(""),$("#residency-info").show(),$(MMSD.addressSearchVars.fieldDisplay).trigger("address:ic"),!0},useUnfoundAddress:function(){let a={number:MMSD.addressSearchVars.number.val(),prefix:MMSD.addressSearchVars.prefix.val(),street:MMSD.addressSearchVars.street.val(),tag:MMSD.addressSearchVars.tag.val(),apt:MMSD.addressSearchVars.apt.val(),city:MMSD.addressSearchVars.city.val(),state:MMSD.addressSearchVars.state.val(),zip:MMSD.addressSearchVars.zip.val()};return $(MMSD.addressSearchVars.fieldID).val(""),MMSD.addresses.uspsAddressSearch(a).done(function(a,b){if(a){$.each(["es","ms","hs","all"],function(a,b){$.each(["codes","names","ids"],function(a,c){$("#"+MMSD.addressSearchVars.fieldsPrefix+b+"-school-"+c).val("")})}),$("#"+MMSD.addressSearchVars.fieldsPrefix+"line1").val(b.line1),$("#"+MMSD.addressSearchVars.fieldsPrefix+"line2").val(b.line2);let a=b.line1+" "+b.line2;$(MMSD.addressSearchVars.fieldDisplay).val(a),$("#residency-info").show(),MMSD.addressSearchVars.modal.modal("hide"),$(MMSD.addressSearchVars.fieldDisplay).trigger("address:usps")}else MMSD.addressSearchVars.failureDiv.hide(),MMSD.addressSearchVars.invalidDiv.show()}).fail(function(a,b){MMSD.main.errorAlert(a,b)}),!0},setDefaultValues:function(){MMSD.addressSearchVars={modal:$("#modal-address-search"),fieldDisplay:"#address-textfield",fieldID:"#addressID",inDistrict:!1,fieldsPrefix:"address-",resultDiv:$("#address-search-results-div"),failureDiv:$("#address-search-failure-div"),ignoreDiv:$("#address-search-ignore-div"),invalidDiv:$("#address-search-invalid-div"),number:$("#addresssearch-number"),prefix:$("#addresssearch-prefix"),street:$("#addresssearch-street"),tag:$("#addresssearch-tag"),apt:$("#addresssearch-apt"),city:$("#addresssearch-city"),state:$("#addresssearch-state"),zip:$("#addresssearch-zip")}},hideDivs:function(a=!1){MMSD.addressSearchVars.failureDiv.hide(),MMSD.addressSearchVars.ignoreDiv.hide(),MMSD.addressSearchVars.invalidDiv.hide(),a||(MMSD.addressSearchVars.resultDiv.hide(),MMSD.addressSearchVars.resultDiv.children().detach())}};