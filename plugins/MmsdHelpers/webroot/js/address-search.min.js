var MMSD=MMSD||{};MMSD.addressSearchVars={},$(document).ready(function(){MMSD.thisApp.setDefaultValues(),$(".address-search-ify").on("focus",function(){MMSD.thisApp.addressSearchIfy($(this))}),MMSD.addressSearchVars.modal.on("shown.bs.modal",function(){$("#addresssearch-number").trigger("focus")}),MMSD.addressSearchVars.modal.on("hidden.bs.modal",function(){MMSD.thisApp.clearAddressSearch()}),$("#address-search-button").on("click",function(){MMSD.thisApp.executeAddressSearch()}),$(".address-search-use-anyway").on("click",function(){MMSD.thisApp.useUnfoundAddress()}),$("#address-search-cancel").on("click",function(){MMSD.thisApp.addressSearchCancel()})}),MMSD.thisApp={addressSearchIfy:function(s){MMSD.thisApp.setDefaultValues(),MMSD.thisApp.hideDivs(),MMSD.addressSearchVars.modal.modal(),null!=s.data("address_search_field_display")&&(MMSD.addressSearchVars.fieldDisplay=s.data("address_search_field_display")),null!=s.data("address_search_field_id")&&(MMSD.addressSearchVars.fieldID=s.data("address_search_field_id")),null!=s.data("address_search_in_district")&&(MMSD.addressSearchVars.inDistrict=s.data("address_search_in_district")),null!=s.data("address_search_fields_prefix")&&(MMSD.addressSearchVars.fieldsPrefix=s.data("address_search_fields_prefix"))},executeAddressSearch:function(){$("#address-search-button").blur();let s={number:MMSD.addressSearchVars.number.val(),prefix:MMSD.addressSearchVars.prefix.val(),street:MMSD.addressSearchVars.street.val(),tag:MMSD.addressSearchVars.tag.val(),apt:MMSD.addressSearchVars.apt.val(),city:MMSD.addressSearchVars.city.val(),state:MMSD.addressSearchVars.state.val(),zip:MMSD.addressSearchVars.zip.val()};MMSD.addressSearchVars.resultDiv.children().detach(),MMSD.addressSearchVars.resultDiv.append($("<div>").addClass("text-center").append($("<img>").attr({src:"/_resources/img/spinners/small-blue.gif"}))),MMSD.addressSearchVars.resultDiv.show(),MMSD.thisApp.hideDivs(!0),MMSD.addressSearchVars.modal.modal("handleUpdate"),$.when(MMSD.addresses.cleanAddressSearch(s)).done(function(s,e){if(s){MMSD.addressSearchVars.resultDiv.children().detach();let s=$("<ul>");$.each(e.addresses,function(e,a){let r="fa-check-circle text-success",d="In MMSD";"200"!=a.districtID&&(r="fa-exclamation-triangle text-danger",d="Out of MMSD"),$("<li>").append($("<span>").attr({class:"mock-link font-weight-bold"}).text(a.fullAddress+" ").on("click",function(){MMSD.thisApp.useFoundAddress(a)?MMSD.addressSearchVars.modal.modal("hide"):alert("Address must be in the MMSD")})).append($("<span>",{class:"fas "+r,"aria-hidden":"true",title:d})).append($("<span>",{class:"sr-only",text:d})).append("<br>").append(MMSD.thisApp.schoolNamesFromAddress(a)).appendTo(s)}),MMSD.addressSearchVars.resultDiv.append(s),MMSD.addressSearchVars.resultDiv.show(),MMSD.addressSearchVars.ignoreDiv.show(),MMSD.addressSearchVars.invalidDiv.hide(),MMSD.addressSearchVars.modal.modal("handleUpdate")}else MMSD.thisApp.hideDivs(),null==e?MMSD.addressSearchVars.failureDiv.show():MMSD.addressSearchVars.invalidDiv.show()}).fail(function(s,e){MMSD.main.errorAlert(s,e),MMSD.thisApp.hideDivs(),MMSD.addressSearchVars.modal.modal("handleUpdate")})},clearAddressSearch:function(){MMSD.addressSearchVars.number.val(""),MMSD.addressSearchVars.prefix.val(""),MMSD.addressSearchVars.street.val(""),MMSD.addressSearchVars.tag.val(""),MMSD.addressSearchVars.apt.val(""),MMSD.addressSearchVars.city.val("Madison"),MMSD.addressSearchVars.state.val("WI"),MMSD.addressSearchVars.zip.val(""),MMSD.addressSearchVars.resultDiv.hide(),MMSD.addressSearchVars.failureDiv.hide(),MMSD.addressSearchVars.ignoreDiv.hide(),MMSD.addressSearchVars.invalidDiv.hide()},schoolNamesFromAddress:function(s){let e=[],a=s.kfour?s.kfour.k4SchoolName:"";if($.each(s.elementary_boundaries,function(s,a){e.push(a.school.name)}),$.each(s.middle_boundaries,function(s,a){e.push(a.school.name)}),$.each(s.high_boundaries,function(s,a){e.push(a.school.name)}),e.length>0){let s=e.join(", "),r="es"==MMSD.properties.getDocumentLanguage()?"Escuelas":"Schools";return r+=": "+s,a.length>0&&(r+="; K4: "+a),$("<span>").text(r)}return null},useFoundAddress:function(s){if(MMSD.addressSearchVars.inDistrict&&"200"!=s.districtID)return!1;$(MMSD.addressSearchVars.fieldDisplay).val(s.fullAddress),$(MMSD.addressSearchVars.fieldID).val(s.id),s.kfour&&(s.kfour.k4SchoolCode&&$("#"+MMSD.addressSearchVars.fieldsPrefix+"k4-school-codes").val(JSON.stringify([s.kfour.k4SchoolCode])),s.kfour.k4SchoolName&&$("#"+MMSD.addressSearchVars.fieldsPrefix+"k4-school-names").val(JSON.stringify([s.kfour.k4SchoolName])),s.kfour.k4SchoolID&&$("#"+MMSD.addressSearchVars.fieldsPrefix+"k4-school-ids").val(JSON.stringify([s.kfour.k4SchoolID])));let e={codes:[],names:[],IDs:[]},a={codes:[],names:[],IDs:[]};$.each(s.elementary_boundaries,function(s,r){a.codes.push(r.school.SchoolCode),a.names.push(r.school.name),a.IDs.push(r.school.schoolID),e.codes.push(r.school.SchoolCode),e.names.push(r.school.name),e.IDs.push(r.school.schoolID)}),$("#"+MMSD.addressSearchVars.fieldsPrefix+"es-school-codes").val(JSON.stringify(a.codes)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"es-school-names").val(JSON.stringify(a.names)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"es-school-ids").val(JSON.stringify(a.IDs));let r={codes:[],names:[],IDs:[]};$.each(s.middle_boundaries,function(s,a){r.codes.push(a.school.SchoolCode),r.names.push(a.school.name),r.IDs.push(a.school.schoolID),e.codes.push(a.school.SchoolCode),e.names.push(a.school.name),e.IDs.push(a.school.schoolID)}),$("#"+MMSD.addressSearchVars.fieldsPrefix+"ms-school-codes").val(JSON.stringify(r.codes)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"ms-school-names").val(JSON.stringify(r.names)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"ms-school-ids").val(JSON.stringify(r.IDs));let d={codes:[],names:[],IDs:[]};return $.each(s.high_boundaries,function(s,a){d.codes.push(a.school.SchoolCode),d.names.push(a.school.name),d.IDs.push(a.school.schoolID),e.codes.push(a.school.SchoolCode),e.names.push(a.school.name),e.IDs.push(a.school.schoolID)}),$("#"+MMSD.addressSearchVars.fieldsPrefix+"hs-school-codes").val(JSON.stringify(d.codes)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"hs-school-names").val(JSON.stringify(d.names)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"hs-school-ids").val(JSON.stringify(d.IDs)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"all-school-codes").val(JSON.stringify(e.codes)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"all-school-names").val(JSON.stringify(e.names)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"all-school-ids").val(JSON.stringify(e.IDs)),$("#"+MMSD.addressSearchVars.fieldsPrefix+"line1").val(s.line1),$("#"+MMSD.addressSearchVars.fieldsPrefix+"line2").val(s.line2),$("#"+MMSD.addressSearchVars.fieldsPrefix+"fullAddress").val(s.fullAddress),$("#residency-info").show(),$(MMSD.addressSearchVars.fieldDisplay).trigger("address:ic"),!0},useUnfoundAddress:function(){let s={number:MMSD.addressSearchVars.number.val(),prefix:MMSD.addressSearchVars.prefix.val(),street:MMSD.addressSearchVars.street.val(),tag:MMSD.addressSearchVars.tag.val(),apt:MMSD.addressSearchVars.apt.val(),city:MMSD.addressSearchVars.city.val(),state:MMSD.addressSearchVars.state.val(),zip:MMSD.addressSearchVars.zip.val()};return $(MMSD.addressSearchVars.fieldID).val(""),MMSD.addresses.uspsAddressSearch(s).done(function(s,e){if(s){$.each(["k4","es","ms","hs","all"],function(s,e){$.each(["codes","names","ids"],function(s,a){$("#"+MMSD.addressSearchVars.fieldsPrefix+e+"-school-"+a).val("")})}),$("#"+MMSD.addressSearchVars.fieldsPrefix+"line1").val(e.line1),$("#"+MMSD.addressSearchVars.fieldsPrefix+"line2").val(e.line2);let s=e.line1+" "+e.line2;$("#"+MMSD.addressSearchVars.fieldsPrefix+"fullAddress").val(s),$(MMSD.addressSearchVars.fieldDisplay).val(s),$("#residency-info").show(),MMSD.addressSearchVars.modal.modal("hide"),$(MMSD.addressSearchVars.fieldDisplay).trigger("address:usps")}else MMSD.addressSearchVars.failureDiv.hide(),MMSD.addressSearchVars.invalidDiv.show()}).fail(function(s,e){MMSD.main.errorAlert(s,e)}),!0},addressSearchCancel:function(){$.each(["k4","es","ms","hs","all"],function(s,e){$.each(["codes","names","ids"],function(s,a){$("#"+MMSD.addressSearchVars.fieldsPrefix+e+"-school-"+a).val("")})}),$("#"+MMSD.addressSearchVars.fieldsPrefix+"line1").val(""),$("#"+MMSD.addressSearchVars.fieldsPrefix+"line2").val(""),$("#"+MMSD.addressSearchVars.fieldsPrefix+"fullAddress").val(""),$(MMSD.addressSearchVars.fieldID).val(""),$(MMSD.addressSearchVars.fieldDisplay).val(""),MMSD.addressSearchVars.modal.modal("hide"),$(MMSD.addressSearchVars.fieldDisplay).trigger("address:cancel")},setDefaultValues:function(){MMSD.addressSearchVars={modal:$("#modal-address-search"),fieldDisplay:"#address-textfield",fieldID:"#addressID",inDistrict:!1,fieldsPrefix:"address-",resultDiv:$("#address-search-results-div"),failureDiv:$("#address-search-failure-div"),ignoreDiv:$("#address-search-ignore-div"),invalidDiv:$("#address-search-invalid-div"),number:$("#addresssearch-number"),prefix:$("#addresssearch-prefix"),street:$("#addresssearch-street"),tag:$("#addresssearch-tag"),apt:$("#addresssearch-apt"),city:$("#addresssearch-city"),state:$("#addresssearch-state"),zip:$("#addresssearch-zip")}},hideDivs:function(s=!1){MMSD.addressSearchVars.failureDiv.hide(),MMSD.addressSearchVars.ignoreDiv.hide(),MMSD.addressSearchVars.invalidDiv.hide(),s||(MMSD.addressSearchVars.resultDiv.hide(),MMSD.addressSearchVars.resultDiv.children().detach())}};